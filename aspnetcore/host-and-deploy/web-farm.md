---
<span data-ttu-id="6ee8b-101">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-101">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-102">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-102">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-103">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-103">'Identity'</span></span>
- <span data-ttu-id="6ee8b-104">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-104">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-105">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-105">'Razor'</span></span>
- <span data-ttu-id="6ee8b-106">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-106">'SignalR' uid:</span></span> 

---
# <a name="host-aspnet-core-in-a-web-farm"></a><span data-ttu-id="6ee8b-107">Размещение ASP.NET Core в веб-ферме</span><span class="sxs-lookup"><span data-stu-id="6ee8b-107">Host ASP.NET Core in a web farm</span></span>

<span data-ttu-id="6ee8b-108">Автор: [Крис Росс](https://github.com/Tratcher) (Chris Ross)</span><span class="sxs-lookup"><span data-stu-id="6ee8b-108">By [Chris Ross](https://github.com/Tratcher)</span></span>

<span data-ttu-id="6ee8b-109">*Веб-ферма* — это группа из двух или нескольких веб-серверов (или *узлов*), на которых размещается несколько экземпляров приложения.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-109">A *web farm* is a group of two or more web servers (or *nodes*) that host multiple instances of an app.</span></span> <span data-ttu-id="6ee8b-110">При поступлении запросов от пользователей на веб-ферму *подсистема балансировки нагрузки* распределяет эти запросы между узлами веб-фермы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-110">When requests from users arrive to a web farm, a *load balancer* distributes the requests to the web farm's nodes.</span></span> <span data-ttu-id="6ee8b-111">Веб-фермы обеспечивают следующие улучшения:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-111">Web farms improve:</span></span>

* <span data-ttu-id="6ee8b-112">**Надежность и доступность.** При сбое одного или нескольких узлов подсистема балансировки нагрузки может направлять запросы на другие работающие узлы, чтобы продолжить обработку запросов.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-112">**Reliability/availability**: When one or more nodes fail, the load balancer can route requests to other functioning nodes to continue processing requests.</span></span>
* <span data-ttu-id="6ee8b-113">**Увеличение емкости и повышение производительности.** Несколько узлов могут обрабатывать больше запросов, чем один сервер.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-113">**Capacity/performance**: Multiple nodes can process more requests than a single server.</span></span> <span data-ttu-id="6ee8b-114">Подсистема распределения нагрузки позволяет балансировать нагрузку за счет ее распределения между узлами.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-114">The load balancer balances the workload by distributing requests to the nodes.</span></span>
* <span data-ttu-id="6ee8b-115">**Масштабируемость.** Если необходимо увеличить или уменьшить емкость, количество активных узлов можно изменять в соответствии с рабочей нагрузкой.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-115">**Scalability**: When more or less capacity is required, the number of active nodes can be increased or decreased to match the workload.</span></span> <span data-ttu-id="6ee8b-116">Технологии для размещения веб-ферм, такие как [служба приложений Azure](https://azure.microsoft.com/services/app-service/), могут автоматически добавлять или удалять узлы по запросу системного администратора, а также могут делать это автоматически без вмешательства человека.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-116">Web farm platform technologies, such as [Azure App Service](https://azure.microsoft.com/services/app-service/), can automatically add or remove nodes at the request of the system administrator or automatically without human intervention.</span></span>
* <span data-ttu-id="6ee8b-117">**Удобство поддержки.** Узлы веб-фермы могут использовать набор общих служб, что упрощает управление системой.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-117">**Maintainability**: Nodes of a web farm can rely on a set of shared services, which results in easier system management.</span></span> <span data-ttu-id="6ee8b-118">Например, узлы веб-фермы могут использовать один сервер базы данных и общее расположение в сети для статических ресурсов, таких как изображения и загружаемые файлы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-118">For example, the nodes of a web farm can rely upon a single database server and a common network location for static resources, such as images and downloadable files.</span></span>

<span data-ttu-id="6ee8b-119">В этом разделе описаны настройки и зависимости для размещенных в веб-фермах приложений ASP.NET Core, которые зависят от общих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-119">This topic describes configuration and dependencies for ASP.NET core apps hosted in a web farm that rely upon shared resources.</span></span>

## <a name="general-configuration"></a><span data-ttu-id="6ee8b-120">Общая конфигурация</span><span class="sxs-lookup"><span data-stu-id="6ee8b-120">General configuration</span></span>

<xref:host-and-deploy/index>  
<span data-ttu-id="6ee8b-121">Сведения о настройке сред размещения и развертывании приложений ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-121">Learn how to set up hosting environments and deploy ASP.NET Core apps.</span></span> <span data-ttu-id="6ee8b-122">Настройка диспетчера процессов на каждом узле веб-фермы для автоматического запуска и перезапуска приложений.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-122">Configure a process manager on each node of the web farm to automate app starts and restarts.</span></span> <span data-ttu-id="6ee8b-123">Для каждого узла требуется среда выполнения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-123">Each node requires the ASP.NET Core runtime.</span></span> <span data-ttu-id="6ee8b-124">Дополнительные сведения см. в разделе [Размещение и развертывание ASP.NET Core](xref:host-and-deploy/index).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-124">For more information, see the topics in the [Host and deploy](xref:host-and-deploy/index) area of the documentation.</span></span>

<xref:host-and-deploy/proxy-load-balancer>  
<span data-ttu-id="6ee8b-125">Сведения о конфигурации приложений, размещаемых за прокси-серверами и подсистемами балансировки нагрузки, которые могут мешать передаче важных сведений в запросах.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-125">Learn about configuration for apps hosted behind proxy servers and load balancers, which often obscure important request information.</span></span>

<xref:host-and-deploy/azure-apps/index>  
<span data-ttu-id="6ee8b-126">[Служба приложений Azure](https://azure.microsoft.com/services/app-service/) — это [платформа облачных вычислений Microsoft](https://azure.microsoft.com/), предназначенная для размещения веб-приложений, включая ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-126">[Azure App Service](https://azure.microsoft.com/services/app-service/) is a [Microsoft cloud computing platform service](https://azure.microsoft.com/) for hosting web apps, including ASP.NET Core.</span></span> <span data-ttu-id="6ee8b-127">Служба приложений — это полностью управляемая платформа, которая обеспечивает автоматическое масштабирование, балансировку нагрузки, исправления и непрерывное развертывание.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-127">App Service is a fully managed platform that provides automatic scaling, load balancing, patching, and continuous deployment.</span></span>

## <a name="app-data"></a><span data-ttu-id="6ee8b-128">Данные приложений</span><span class="sxs-lookup"><span data-stu-id="6ee8b-128">App data</span></span>

<span data-ttu-id="6ee8b-129">Когда приложение масштабируется до нескольких экземпляров, может возникнуть такое состояние, когда требуется совместное использование на нескольких узлах.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-129">When an app is scaled to multiple instances, there might be app state that requires sharing across nodes.</span></span> <span data-ttu-id="6ee8b-130">Если состояние является временным, рассмотрите возможность совместного использования кэша [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-130">If the state is transient, consider sharing an [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span></span> <span data-ttu-id="6ee8b-131">Если общее состояние должно сохраняться постоянно, рассмотрите возможность хранения сведений об общем состоянии в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-131">If the shared state requires persistence, consider storing the shared state in a database.</span></span>

## <a name="required-configuration"></a><span data-ttu-id="6ee8b-132">Необходимая настройка</span><span class="sxs-lookup"><span data-stu-id="6ee8b-132">Required configuration</span></span>

<span data-ttu-id="6ee8b-133">Для защиты данных и кэширования необходимо настроить приложения, развернутые в веб-ферме.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-133">Data Protection and Caching require configuration for apps deployed to a web farm.</span></span>

### <a name="data-protection"></a><span data-ttu-id="6ee8b-134">Защита данных</span><span class="sxs-lookup"><span data-stu-id="6ee8b-134">Data Protection</span></span>

<span data-ttu-id="6ee8b-135">[Система защиты данных в ASP.NET Core](xref:security/data-protection/introduction) используется приложениями для защиты данных.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-135">The [ASP.NET Core Data Protection system](xref:security/data-protection/introduction) is used by apps to protect data.</span></span> <span data-ttu-id="6ee8b-136">Защита данных зависит от набора криптографических ключей, хранящихся в *наборе ключей*.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-136">Data Protection relies upon a set of cryptographic keys stored in a *key ring*.</span></span> <span data-ttu-id="6ee8b-137">При инициализации системы защиты данных применяются [параметры по умолчанию](xref:security/data-protection/configuration/default-settings), которые предусматривают локальное хранение набора ключей.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-137">When the Data Protection system is initialized, it applies [default settings](xref:security/data-protection/configuration/default-settings) that store the key ring locally.</span></span> <span data-ttu-id="6ee8b-138">В соответствии с конфигурацией по умолчанию уникальный набор ключей хранится на каждом узле веб-фермы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-138">Under the default configuration, a unique key ring is stored on each node of the web farm.</span></span> <span data-ttu-id="6ee8b-139">Следовательно, узел веб-фермы не может расшифровать данные, зашифрованные с помощью приложения на другом узле.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-139">Consequently, each web farm node can't decrypt data that's encrypted by an app on any other node.</span></span> <span data-ttu-id="6ee8b-140">Обычно конфигурация по умолчанию не подходит для размещения приложений в веб-ферме.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-140">The default configuration isn't generally appropriate for hosting apps in a web farm.</span></span> <span data-ttu-id="6ee8b-141">Кроме использования общего набора ключей можно прибегнуть к варианту, когда запросы пользователей на постоянной основе направляются на один и тот же узел.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-141">An alternative to implementing a shared key ring is to always route user requests to the same node.</span></span> <span data-ttu-id="6ee8b-142">Дополнительные сведения о настройке системы защиты данных для развертываний в веб-фермах см. в разделе <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-142">For more information on Data Protection system configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span>

### <a name="caching"></a><span data-ttu-id="6ee8b-143">Кэширование</span><span class="sxs-lookup"><span data-stu-id="6ee8b-143">Caching</span></span>

<span data-ttu-id="6ee8b-144">В среде веб-фермы механизм кэширования должен совместно использовать кэшированные элементы на узлах веб-фермы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-144">In a web farm environment, the caching mechanism must share cached items across the web farm's nodes.</span></span> <span data-ttu-id="6ee8b-145">Кэширование должно зависеть от общего кэша Redis, общей базы данных SQL Server или пользовательской реализации кэширования, которая совместно использует кэшированные элементы в веб-ферме.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-145">Caching must either rely upon a common Redis cache, a shared SQL Server database, or a custom caching implementation that shares cached items across the web farm.</span></span> <span data-ttu-id="6ee8b-146">Для получения дополнительной информации см. <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-146">For more information, see <xref:performance/caching/distributed>.</span></span>

## <a name="dependent-components"></a><span data-ttu-id="6ee8b-147">Зависимые компоненты</span><span class="sxs-lookup"><span data-stu-id="6ee8b-147">Dependent components</span></span>

<span data-ttu-id="6ee8b-148">Для следующих сценариев дополнительная конфигурация не требуется, но они зависят от технологий, которые требуют настройки для веб-ферм.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-148">The following scenarios don't require additional configuration, but they depend on technologies that require configuration for web farms.</span></span>

| <span data-ttu-id="6ee8b-149">Сценарий</span><span class="sxs-lookup"><span data-stu-id="6ee8b-149">Scenario</span></span> | <span data-ttu-id="6ee8b-150">Зависит от &hellip;</span><span class="sxs-lookup"><span data-stu-id="6ee8b-150">Depends on &hellip;</span></span> |
| ---
<span data-ttu-id="6ee8b-151">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-151">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-152">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-152">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-153">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-153">'Identity'</span></span>
- <span data-ttu-id="6ee8b-154">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-154">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-155">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-155">'Razor'</span></span>
- <span data-ttu-id="6ee8b-156">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-156">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-157">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-157">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-158">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-158">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-159">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-159">'Identity'</span></span>
- <span data-ttu-id="6ee8b-160">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-160">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-161">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-161">'Razor'</span></span>
- <span data-ttu-id="6ee8b-162">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-162">'SignalR' uid:</span></span> 

<span data-ttu-id="6ee8b-163">---- | --- название: автор: описание:  monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-163">---- | --- title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-164">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-164">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-165">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-165">'Identity'</span></span>
- <span data-ttu-id="6ee8b-166">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-166">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-167">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-167">'Razor'</span></span>
- <span data-ttu-id="6ee8b-168">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-168">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-169">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-169">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-170">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-170">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-171">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-171">'Identity'</span></span>
- <span data-ttu-id="6ee8b-172">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-172">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-173">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-173">'Razor'</span></span>
- <span data-ttu-id="6ee8b-174">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-174">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-175">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-175">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-176">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-176">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-177">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-177">'Identity'</span></span>
- <span data-ttu-id="6ee8b-178">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-178">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-179">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-179">'Razor'</span></span>
- <span data-ttu-id="6ee8b-180">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-180">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-181">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-181">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-182">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-182">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-183">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-183">'Identity'</span></span>
- <span data-ttu-id="6ee8b-184">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-184">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-185">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-185">'Razor'</span></span>
- <span data-ttu-id="6ee8b-186">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-186">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-187">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-187">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-188">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-188">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-189">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-189">'Identity'</span></span>
- <span data-ttu-id="6ee8b-190">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-190">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-191">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-191">'Razor'</span></span>
- <span data-ttu-id="6ee8b-192">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-192">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-193">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-193">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-194">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-194">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-195">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-195">'Identity'</span></span>
- <span data-ttu-id="6ee8b-196">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-196">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-197">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-197">'Razor'</span></span>
- <span data-ttu-id="6ee8b-198">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-198">'SignalR' uid:</span></span> 

-
<span data-ttu-id="6ee8b-199">название: автор: описание: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span><span class="sxs-lookup"><span data-stu-id="6ee8b-199">title: author: description: monikerRange: ms.author: ms.custom: ms.date: no-loc:</span></span>
- <span data-ttu-id="6ee8b-200">'Blazor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-200">'Blazor'</span></span>
- <span data-ttu-id="6ee8b-201">'Identity'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-201">'Identity'</span></span>
- <span data-ttu-id="6ee8b-202">'Let's Encrypt'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-202">'Let's Encrypt'</span></span>
- <span data-ttu-id="6ee8b-203">'Razor'</span><span class="sxs-lookup"><span data-stu-id="6ee8b-203">'Razor'</span></span>
- <span data-ttu-id="6ee8b-204">ИД пользователя "SignalR":</span><span class="sxs-lookup"><span data-stu-id="6ee8b-204">'SignalR' uid:</span></span> 

<span data-ttu-id="6ee8b-205">---------- | | Проверка подлинности | Защита данных (см. статью <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-205">---------- | | Authentication | Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="6ee8b-206">Дополнительные сведения см. в разделах <xref:security/authentication/cookie> и <xref:security/cookie-sharing>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-206">For more information, see <xref:security/authentication/cookie> and <xref:security/cookie-sharing>.</span></span> <span data-ttu-id="6ee8b-207">| | Identity | Проверка подлинности и конфигурация базы данных.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-207">| | Identity | Authentication and database configuration.</span></span><br><br><span data-ttu-id="6ee8b-208">Для получения дополнительной информации см. <xref:security/authentication/identity>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-208">For more information, see <xref:security/authentication/identity>.</span></span> <span data-ttu-id="6ee8b-209">| | Сеанс | Защита данных (зашифрованные файлы cookie) (см. раздел <xref:security/data-protection/configuration/overview>) и кэширование (см. раздел <xref:performance/caching/distributed>).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-209">| | Session | Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) and Caching (see <xref:performance/caching/distributed>).</span></span><br><br><span data-ttu-id="6ee8b-210">Дополнительные сведения см. в статье [Управление сеансом и состоянием: ASP.NET Core](xref:fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-210">For more information, see [Session and state management: Session state](xref:fundamentals/app-state#session-state).</span></span> <span data-ttu-id="6ee8b-211">| | TempData | Защита данных (зашифрованные файлы cookie) (см. в статье <xref:security/data-protection/configuration/overview>) или в разделе "Сеанс" статьи [Управление сеансом и состоянием: ASP.NET Core](xref:fundamentals/app-state#session-state)).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-211">| | TempData | Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) or Session (see [Session and state management: Session state](xref:fundamentals/app-state#session-state)).</span></span><br><br><span data-ttu-id="6ee8b-212">Дополнительные сведения см. в статье [Управление сеансом и состоянием: ASP.NET Core](xref:fundamentals/app-state#tempdata).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-212">For more information, see [Session and state management: TempData](xref:fundamentals/app-state#tempdata).</span></span> <span data-ttu-id="6ee8b-213">| | Защита от подделки | Защита данных (см. статью <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="6ee8b-213">| | Anti-forgery | Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="6ee8b-214">Для получения дополнительной информации см. <xref:security/anti-request-forgery>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-214">For more information, see <xref:security/anti-request-forgery>.</span></span> |

## <a name="troubleshoot"></a><span data-ttu-id="6ee8b-215">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="6ee8b-215">Troubleshoot</span></span>

### <a name="data-protection-and-caching"></a><span data-ttu-id="6ee8b-216">Защита и кэширование данных</span><span class="sxs-lookup"><span data-stu-id="6ee8b-216">Data Protection and caching</span></span>

<span data-ttu-id="6ee8b-217">Если функции защиты данных или кэширования не настроены для среды веб-фермы, при обработке запросов будут периодически возникать ошибки.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-217">When Data Protection or caching isn't configured for a web farm environment, intermittent errors occur when requests are processed.</span></span> <span data-ttu-id="6ee8b-218">Это происходит, так как узлы не используют одни и те же ресурсы, а запросы пользователей не всегда перенаправляются на один и тот же узел.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-218">This occurs because nodes don't share the same resources and user requests aren't always routed back to the same node.</span></span>

<span data-ttu-id="6ee8b-219">Представьте пользователя, который входит в приложение, используя проверку подлинности с помощью файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-219">Consider a user who signs into the app using cookie authentication.</span></span> <span data-ttu-id="6ee8b-220">Пользователь вошел в приложение на одном узле веб-фермы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-220">The user signs into the app on one web farm node.</span></span> <span data-ttu-id="6ee8b-221">Если следующий запрос пользователя направляется на тот же узел, на котором был выполнен вход в систему, приложение сможет расшифровать файл cookie проверки подлинности и разрешит доступ к ресурсу приложения.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-221">If their next request arrives at the same node where they signed in, the app is able to decrypt the authentication cookie and allows access to the app's resource.</span></span> <span data-ttu-id="6ee8b-222">Если же следующий запрос направляется на другой узел, приложение не сможет расшифровать файл cookie проверки подлинности с узла, на котором пользователь вошел в систему, и попытка авторизации для запрашиваемого ресурса будет отклонена.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-222">If their next request arrives at a different node, the app can't decrypt the authentication cookie from the node where the user signed in, and authorization for the requested resource fails.</span></span>

<span data-ttu-id="6ee8b-223">Если **время от времени** возникают какие-либо из описанных далее симптомов, в большинстве случаев это связано с неправильной конфигурацией функции защиты данных или кэширования для среды веб-фермы.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-223">When any of the following symptoms occur **intermittently**, the problem is usually traced to improper Data Protection or caching configuration for a web farm environment:</span></span>

* <span data-ttu-id="6ee8b-224">Сбои при проверке подлинности — файл cookie проверки подлинности настроен неправильно или не может быть расшифрован.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-224">Authentication breaks: The authentication cookie is misconfigured or can't be decrypted.</span></span> <span data-ttu-id="6ee8b-225">Сбои при попытке использования имен входа для OAuth (Facebook, Майкрософт, Twitter) или OpenIdConnect — попытки завершаются ошибкой "Не удалось выполнить корреляцию".</span><span class="sxs-lookup"><span data-stu-id="6ee8b-225">OAuth (Facebook, Microsoft, Twitter) or OpenIdConnect logins fail with the error "Correlation failed."</span></span>
* <span data-ttu-id="6ee8b-226">Сбои при попытке авторизации — Identity отсутствует.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-226">Authorization breaks: Identity is lost.</span></span>
* <span data-ttu-id="6ee8b-227">Отсутствие данных о состоянии сеанса.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-227">Session state loses data.</span></span>
* <span data-ttu-id="6ee8b-228">Удаление кэшированных элементов.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-228">Cached items disappear.</span></span>
* <span data-ttu-id="6ee8b-229">Сбои свойства TempData.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-229">TempData fails.</span></span>
* <span data-ttu-id="6ee8b-230">Сбои самотестирования при включении питания (POST) — не удается выполнить проверку для защиты от подделки.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-230">POSTs fail: The anti-forgery check fails.</span></span>

<span data-ttu-id="6ee8b-231">Дополнительные сведения о настройке защиты данных для развертываний в веб-фермах см. в разделе <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-231">For more information on Data Protection configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span> <span data-ttu-id="6ee8b-232">Дополнительные сведения о настройке кэширования для развертываний в веб-фермах см. в здесь: <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-232">For more information on caching configuration for web farm deployments, see <xref:performance/caching/distributed>.</span></span>

## <a name="obtain-data-from-apps"></a><span data-ttu-id="6ee8b-233">Получение данных из приложений</span><span class="sxs-lookup"><span data-stu-id="6ee8b-233">Obtain data from apps</span></span>

<span data-ttu-id="6ee8b-234">Если фермы веб-приложения способны отвечать на запросы, получите данные о запросе, подключении и дополнительные данные из приложений с помощью встроенного терминала ПО промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-234">If the web farm apps are capable of responding to requests, obtain request, connection, and additional data from the apps using terminal inline middleware.</span></span> <span data-ttu-id="6ee8b-235">Дополнительные сведения и примеры с кодом см. здесь: <xref:test/troubleshoot#obtain-data-from-an-app>.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-235">For more information and sample code, see <xref:test/troubleshoot#obtain-data-from-an-app>.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="6ee8b-236">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="6ee8b-236">Additional resources</span></span>

* <span data-ttu-id="6ee8b-237">[Расширение пользовательских сценариев для Windows](/azure/virtual-machines/extensions/custom-script-windows): скачивает и выполняет сценарии на виртуальных машинах Azure, что удобно для настройки после развертывания и установки программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="6ee8b-237">[Custom Script Extension for Windows](/azure/virtual-machines/extensions/custom-script-windows): Downloads and executes scripts on Azure virtual machines, which is useful for post-deployment configuration and software installation.</span></span>
* <xref:host-and-deploy/proxy-load-balancer>
 